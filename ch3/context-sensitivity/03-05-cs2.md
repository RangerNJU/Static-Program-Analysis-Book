# ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æï¼ˆä¸‹ï¼‰

> ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†ææ˜¯æé«˜æŒ‡é’ˆåˆ†æç²¾åº¦æœ€æœ‰æ•ˆçš„æŠ€æœ¯ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚

æœ¬è¯¾åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š

1. Introduction\(Example\)
2. Introduction\(Theory\)
3. Context Sensitive Pointer Analysis: Rules
4. Context Sensitive Pointer Analysis: Algorithms
5. Context Sensitivity Variants

åœ¨ä¸ŠåŠç¯‡ä¸­æˆ‘ä»¬è®²è§£äº†å‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œä¸‹åŠç¯‡æ¥ç»§ç»­è®²æœ€åçš„ä¸¤ä¸ªéƒ¨åˆ†ã€‚

~~æŒ–ä¸ªå‘â€”â€”æœ¬æ–‡æ‰€æœ‰çš„ä¾‹å­å…¶å®éƒ½æ›´é€‚åˆè§†é¢‘è®²è§£ã€‚~~

## Context Sensitive Pointer Analysis: Algorithms

### Idea

é™¤äº†PFGåšäº†ç›¸åº”æ”¹è¿›ä¹‹å¤–ï¼Œç®—æ³•çš„æ€»ä½“æ€è·¯æ²¡æœ‰æ”¹å˜ã€‚

![](../../.gitbook/assets/image-20201210183358390.png)

å…·ä½“æ¥è¯´ï¼Œå¸¦æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„Nodeå’ŒEdgeçš„æ„æˆå¸¦æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„PFGï¼š

![](../../.gitbook/assets/image-20201210183700963.png)

### Algorithm

![](../../.gitbook/assets/image-20201210184448955.png)

ä¹ä¸€çœ‹æŒºå“äººçš„ï¼Œå¯¹å§ï¼Ÿä¸è¿‡ä½ åº”è¯¥å¯¹ä¸Šä¸‹æ–‡æ•æ„Ÿ\(C.S.\)æŒ‡é’ˆåˆ†æç®—æ³•çš„å°ä¼™ä¼´ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿ\(C.I.\)æŒ‡é’ˆåˆ†æç®—æ³•å¾ˆç†Ÿæ‚‰äº†ï¼ˆä¸‹å›¾ä¸­æ‰€æœ‰ä¸Šä¸‹æ–‡æ ‡è®°éƒ½ç”¨è‰²å—é®æŒ¡äº†ï¼‰ï¼š

![](../../.gitbook/assets/image-20201210184527645.png)

å› æ­¤ï¼Œåœ¨æ¥ä¸‹æ¥çš„å†…å®¹ä¸­æˆ‘ä»¬æ›´å…³æ³¨å’Œä¸Šä¸‹æ–‡ç›¸å…³çš„éƒ¨åˆ†ï¼Œè€Œä¸åƒä¹‹å‰ä¸€æ ·è¯¦ç»†åœ°å…³æ³¨æ‰€æœ‰ç»†èŠ‚ã€‚

å€¼å¾—ä¸€æçš„å·®å¼‚æ˜¯ï¼ŒRMå’ŒCGä¸¤ä¸ªé›†åˆåœ¨æœ¬èŠ‚æ‰€è¿°çš„ä¸Šä¸‹æ–‡æ•æ„Ÿç®—æ³•ä¸­éƒ½æ˜¯å¸¦æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨C.S.çš„åˆ†æä¸­ï¼Œcallerå’Œcalleeéƒ½å¸¦æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆ$$ c^t$$ ä»£è¡¨calleeçš„ä¸Šä¸‹æ–‡æ ‡è®°ï¼Œc:2-&gt;$$ c^t:\dots$$è¡¨ç¤ºç¬¬äºŒè¡Œçš„callerè°ƒç”¨äº†å¸¦æœ‰$$ c^t$$æ ‡è®°çš„calleeï¼‰ï¼š

![](../../.gitbook/assets/image-20201210184850528.png)

### Select in ProcessCall

![](../../.gitbook/assets/image-20201216202538515.png)

åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬åªéœ€è¦ç†è§£Selectçš„ä½œç”¨ï¼ˆå¯¹äºSelectçš„å…·ä½“å®ç°ï¼Œä¼šåœ¨åé¢è®²è§£ï¼‰ï¼š

* ProcessCallæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæ„ä¹‰æ˜¯ï¼šå¸¦æœ‰ä¸Šä¸‹æ–‡æ ‡è®°çš„xæ–°å¢ä¸€ä¸ªå¸¦æœ‰ä¸Šä¸‹æ–‡æ ‡è®°æŒ‡å‘ç›®æ ‡oã€‚
* mä»£è¡¨ç›®æ ‡æ–¹æ³•ã€‚
* Selectæ¥æ”¶å‚æ•°ï¼ˆè¿™é‡Œè™½ç„¶æœ‰3ä¸ªå‚æ•°ï¼Œä½†å¹¶éæ¯ç§å®ç°æ–¹å¼éƒ½éœ€è¦ç”¨åˆ°æ‰€æœ‰çš„3ä¸ªå‚æ•°ï¼‰
  * cã€‚xçš„ä¸Šä¸‹æ–‡æ ‡è®°
  * lã€‚è°ƒç”¨ç‚¹æœ¬èº«ï¼ˆcall siteï¼‰ï¼Œåœ¨ä¾‹å­ä¸­ä»¥è¡Œå·æ ‡è¯†è°ƒç”¨ç‚¹
  * $$ c' : o_i $$ã€‚receiver object
* Selectè¿”å›calleeçš„context $$ c^t$$

## Context Sensitivity Variants

> é‚£ï¼Œè®²è®²Selectå§ï¼Ÿ

Selectå‡½æ•°å®ç°æ—¶çš„å…·ä½“å·®å¼‚ï¼Œäº§ç”Ÿäº†ä¸åŒçš„ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æçš„å˜ç§æ–¹æ³•ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„ä¼˜ç¼ºç‚¹ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯

![](../../.gitbook/assets/image-20201210191310040.png)

### C.I.

* å¯ä»¥è§†ä¸º**C.S. çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ**ï¼Œæ— è®ºä¼ é€’ç»™Selectçš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œæ€»æ˜¯è¿”å›åŒæ ·çš„ä¸Šä¸‹æ–‡ã€‚å³ï¼š

```java
Select(*,*,*) = []
```

### Call-Site Sensitivity

* ç”¨ä¸€ç³»åˆ—çš„**è°ƒç”¨é“¾\(call chain/call stream\)ä½œä¸ºä¸Šä¸‹æ–‡æ ‡è¯†**ã€‚
* Also called **call-string sensitivity**, or **k-CFA**

```java
Select(c,l,*) = [ğ‘™`, ğ‘™``, ğ‘™]
// where ğ‘ = [ğ‘™`, â€¦ , ğ‘™``]
// å³ï¼šåªæ ¹æ®callerå·²æœ‰çš„ä¸Šä¸‹æ–‡å’Œ
// call-siteçš„æ–°å¢ä¸Šä¸‹æ–‡
// è®¡ç®—calleeçš„ä¸Šä¸‹æ–‡
```

ä¸¾ä¸ªä¾‹å­ç›´è§‚åœ°å±•ç¤ºCall-Site Sensitivityï¼š

![](../../.gitbook/assets/image-20201210192001954.png)

å½“ç„¶ï¼Œå¦‚æœbaræ˜¯é€’å½’çš„ï¼Œåˆ†æå‡ºæ¥çš„contextå¯èƒ½ä¼šåŒ…å«éå¸¸å¤šçš„å†…å®¹â€¦â€¦

![](../../.gitbook/assets/image-20201210193321202.png)

#### k-Limiting Context Abstraction

ä¸ºäº†é¿å…ä¸Šé¢æ‰€è¯´çš„é€’å½’å¯¼è‡´çš„ç®—æ³•æ— æ³•ç»ˆæ­¢çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç»™contextsçš„é•¿åº¦è®¾ä¸€ä¸ªä¸Šç•Œkã€‚

* 1-call-site/1-CFA

  ```java
  Select(*,l,*) = [l]
  // å³ï¼šä¸ç»§æ‰¿callerå·²ç»å¸¦æœ‰çš„ä¸Šä¸‹æ–‡
  // åªè€ƒè™‘call-siteæ–°å¼•å…¥çš„ä¸Šä¸‹æ–‡
  // "åªè®°å¾—æœ€è¿‘ä¸€æ¬¡ç»è¿‡çš„è·¯å£æ˜¯å“ªä¸€ä¸ª"
  ```

  ![](../../.gitbook/assets/image-20201210193735607.png)

* 2-call-site/2-CFA

  ```java
  Select(c,l,*) = [l``,l]
  // where c = [l`,l``]
  // å³ï¼š"åªè®°å¾—æœ€åä¸¤æ¬¡ç»è¿‡çš„è·¯å£æ˜¯å“ªä¸¤ä¸ª"
  ```

### Call-Site Example

åˆ†æä»¥ä¸‹ä»£ç ï¼Œç»™å‡ºæŒ‡é’ˆæµå›¾PFGå’Œè°ƒç”¨å…³ç³»å›¾CGä½œä¸ºç»“æœã€‚ï¼ˆä¸éœ€è¦å…³æ³¨heapä¸Šçš„å˜é‡å’Œthiså˜é‡ï¼Œå› ä¸ºå®ƒä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­ä¸æ˜¯é‡ç‚¹ï¼‰

```java
class C {
    static void main() {
        C c = new C();
        c.m();
    }

    Number id(Number n) {
        return n;
    }
    void m() {
        Number n1,n2,x,y;
        n1 = new One();
        n2 = new Two();
        x = this.id(n1);
        y = this.id(n2);
        x.get(); 
        // å…ˆæƒ³æƒ³åŠ¨æ€æ‰§è¡Œçš„æ—¶å€™ä¸Šä¸€è¡Œè°ƒç”¨çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ
    }
}
```

ç­”æ¡ˆå¦‚ä¸‹ï¼š

![](../../.gitbook/assets/image-20201216204823876.png)

å’ŒC.I.å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¯¹äº16è¡Œå¤„çš„åˆ†æï¼ŒC.S.\(1-Call-Site\)æ›´åŠ ç²¾ç¡®ã€‚

![](../../.gitbook/assets/image-20201216205125278.png)

### Object Sensitivity

* **ä»¥receiver objectä½œä¸ºä¸Šä¸‹æ–‡æ ‡è¯†**
* Each context consists of a list of abstract objects \(represented by their allocation sites\)
  * At a method call, use the receiver object with its heap 

    context as callee context

  * Distinguish the operations of data flow on different objects
* ![](../../.gitbook/assets/image-20201210195519912.png)

### Object Example & Comparison

åˆ†åˆ«ç”¨1-Call-Siteå’Œ1-Objectçš„æ–¹å¼åˆ†æä»¥ä¸‹ä»£ç ï¼Œç»™å‡ºæ‰€æœ‰æŒ‡é’ˆï¼ˆåŒ…æ‹¬Variableå’ŒFieldï¼‰æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚

```java
a1 = new A();
a2 = new A();
b1 = new B();
b2 = new B();
a1.set(b1);
a2.set(b2);
x = a1.get();

class A {
    B f;
    void set(B b) {
        this.doSet(b);
    }
    void doSet(B p) {
        this.f = p;
    }
    B get() {
        return this.f;
    }
}
```

![](../../.gitbook/assets/image-20201210200518022.png)

åœ¨12è¡Œï¼Œ1-call-siteçš„åˆ†ææ–¹æ³•äº§ç”Ÿäº†ä¸ç²¾ç¡®åˆ†æç»“æœã€‚åœ¨Call Graphä¸­æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°çœ‹åˆ°è¿™ä¸€ç‚¹ï¼š

![](../../.gitbook/assets/image-20201210200637330.png)

æ›´åŠ é€šä¿—åœ°è¯´ï¼Œ1-call-siteåªèƒ½è®°å¾—è‡ªå·±æ˜¯ä»å“ªä¸ªè·¯å£èµ°åˆ°å½“å‰ä½ç½®çš„ï¼Œè€Œ1-objectèƒ½å¤Ÿè®°å¾—è‡ªå·±æ˜¯è°ã€‚

ç„¶è€Œå¹¶ä¸èƒ½è¯´æ˜1-objectçš„ç²¾åº¦ä¸€å®šæ¯”1-call-siteé«˜ã€‚æ¯”å¦‚åœ¨åˆ†æä»¥ä¸‹ä»£ç æ—¶ï¼š

```java
class C {
    static void main() {
        C c = new C();
        c.m(); 
    }

    Number id(Number n) {
        return n;
    }

    void m() {
        Number n1,n2,x,y;
        n1 = new One();
        n2 = new Two();
        x = this.id(n1);
        y = this.id(n2);
        // 1-objectæ— æ³•åŒºåˆ†ä»¥ä¸Šä¸¤æ¡è°ƒç”¨
        // ä½†æ˜¯1-call-siteå¯ä»¥åŒºåˆ†
        x.get();
    }
}
```

å› æ­¤ï¼Œåœ¨**ç†è®ºä¸Š**ï¼Œä¸¤ç§æ–¹æ³•ä¸å¯æ¯”ã€‚è€Œåœ¨é’ˆå¯¹OOè¯­è¨€\(å¦‚Java\)çš„**å®è·µä¸­**ï¼Œobjectæ–¹æ³•çš„è¡¨ç°ï¼ˆæ— è®ºæ˜¯ç²¾åº¦è¿˜æ˜¯é€Ÿåº¦ï¼‰**é€šå¸¸**æ›´å¥½ï¼Œå› ä¸ºè¿™æ›´ç¬¦åˆOOè¯­è¨€çš„ç‰¹æ€§ã€‚

### Type Sensitivity

* å’ŒObject Sensitivityç±»ä¼¼ï¼Œä½†æ˜¯ç²’åº¦æ›´ç²—è€Œæ•ˆç‡æ›´é«˜â€”â€”è¿™ç§æ–¹æ³•åªå…³æ³¨Objectæ˜¯åœ¨å“ªä¸€ä¸ªClassä¸­è¢«å£°æ˜çš„ã€‚
* Each context consists of a list of types
  * At a method call, use the type containing the allocation site of the receiver object with its heap context as callee context

![](../../.gitbook/assets/image-20201210201540194.png)

ä¾‹å¦‚ï¼ˆå¦‚æœä½ å‘ç°è¿™ä¸ªä¾‹å­ä¸å¤ªå¥½ç†è§£ï¼Œè¯·å…ˆå¾€ä¸‹çœ‹çœ‹ä¸‹ä¸€ä¸ªä¾‹å­ï¼‰ï¼š

![](../../.gitbook/assets/image-20201216210158092.png)

### Comparison\(Type vs. Object Sensitivity\)

é˜…è¯»é¡ºåºå»ºè®®ï¼šç»¿æ¡†-&gt;è“æ¡†-&gt;æ— æ¡†ã€‚åœ¨Object-sensitivityä¸­æˆ‘ä»¬è®°å½•ä¸‹æ¯ä¸€ä¸ªobjectè¢«å£°æ˜å‡ºæ¥çš„è¡Œæ•°ã€‚åœ¨Type-sensitivityä¸­æˆ‘ä»¬åªè®°å½•å®ƒä»¬éƒ½æ˜¯åœ¨Class Xä¸­å£°æ˜çš„ã€‚

![](../../.gitbook/assets/image-20201216210347469.png)

### Sum up

In generalï¼š

* Precision: object &gt; type &gt; call-site
* Efficiency: type &gt; object &gt; call-site

## Key points

* **Algorithm** for context-sensitive pointer analysis    
  * å’ŒC.I.å‡ ä¹ä¸€è‡´
* 3 Common context sensitivity **variants**
  * Call-Site Sensitivity
  * Object Sensitivity
  * Type Sensitivity
* **Differences and relationship** among common 

  context sensitivity variants

  * åœ¨é¢å‘å¯¹è±¡è¯­è¨€ï¼ˆå¦‚Javaï¼‰ä¸­ï¼ŒObject Sensitivityé€šå¸¸æ¯”Call-Site Sensitivityè¡¨ç°æ›´å¥½
  * å¦‚æœè¿½æ±‚é€Ÿåº¦ï¼Œå¯ä»¥è¿›è€Œé€‰ç”¨Type Sensitivity

